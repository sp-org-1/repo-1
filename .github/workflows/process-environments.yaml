name: Process environments
on: 
  workflow_dispatch: 
jobs:
  get-envs:
    uses: sp-org-1/repo-1/.github/workflows/get-environments.yaml@master
  test:
    runs-on: ubuntu-latest
    needs: get-envs
    steps:
      - run: echo "${{ needs.get_envs.outputs.environments }}"
  deploy:
    runs-on: ubuntu-latest
    needs: get-envs
    strategy:
      matrix:
        environment: [dev, stage]
        #environment:${{ fromJson(needs.get_envs.outputs.environments) }}
    environment:
      name: ${{ matrix.environment }}
    steps:
      - run: echo "${{ vars.ENV_VAR }}"
